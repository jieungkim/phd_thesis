\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}
\definecolor{ltblue}{rgb}{0,0.4,0.4}
\definecolor{dkblue}{rgb}{0,0.1,0.6}
\definecolor{dkgreen}{rgb}{0,0.35,0}
\definecolor{dkviolet}{rgb}{0.3,0,0.5}
\definecolor{dkred}{rgb}{0.5,0,0}
%----------------------------------------------------

%
\newtheoremstyle{custom}% name
  {\topsep}%         Space above, empty = `usual value'
  {\topsep}%         Space below
   {\itshape}% {\upshape} % Body font
  {}%         Indent amount (empty = no indent, \parindent = para indent)
  {\bfseries}% Thm head font
  {.}%        Punctuation after thm head
  {\newline }% Space after thm head: \newline = linebreak
  {}%         Thm head spec
\theoremstyle{custom}

%\newenvironment{myTheorem}[1][]
%{\savebox\mybox{\hbox{Theorem \thetheorem}}%
%\xdef\mdim{\the\dimexpr\wd\mybox+10pt}%
%\xdef\mybdim{\the\dimexpr\textwidth-\mdim-\myspbetween}%
%\noindent\begin{minipage}[t]{\mdim}%
%\begin{theorem}[#1]\end{theorem}\end{minipage}\hspace{\fill}\begin{minipage}[t]{\mybdim}}
%{\end{minipage}\medskip}

% for tabular
\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}}

\lstset{ %
	backgroundcolor=\color{white},   % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}
	basicstyle=\ttfamily,      % the size of the fonts that are used for the code
	breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
	breaklines=true,                 % sets automatic line breaking
	%captionpos=b,                   % sets the caption-position to bottom
	commentstyle=\color{red},    % comment style
	morecomment=[l]{//},
    %morecomment=[s]{/*}{*/},
%    morecomment=[s]{/*}{*/},
%    morecomment=[s]{*}{;},
%    morecomment=[n]{/*}{*/},
%    morecomment=[n]{*}{;},
%    morecomment=[s]{(*}{*)},
%    morecomment=[n]{(*}{*)},
%    morecomment=[s]{(**}{*)},
%    morecomment=[n]{(**}{*)},
%    morecomment=[f][0][\color{green}]{'},
%    morecomment=[f][\color{red}][0]{\#},
	deletekeywords={...},            % if you want to delete keywords from the given language
	escapeinside={<@}{@>},          % if you want to add LaTeX within your code
	extendedchars=true,              % lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
	frame=none,	                   % adds a frame around the code
	keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
	keywordstyle=\color{blue},       % keyword style
	language=Octave,                 % the language of the code
	otherkeywords={*, Lemma, Theorem, Proof, Qed, Inductive, Fixpoint, Record, typedef, struct, Function , Definition, Prop, then, Variables, Context, Local, Global, 
	Program, Instance, Obligation, Tactic, ...},           % if you want to add more keywords to the set
	emph = {in, uint, match, end, with, let, ret, do, forall, exist,  :=, =>, ->},
	emphstyle=\bf,%
	moredelim=[is][emphstyle]{|>}{<|},%
	numbers=left,                    % where to put the line-numbers; possible values are (none, left, right)
	numbersep=5pt,                   % how far the line-numbers are from the code
	numberstyle=\scriptsize\color{mygray}, % the style that is used for the line-numbers
	rulecolor=\color{black},         % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
	showspaces=false,                % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
	showstringspaces=false,          % underline spaces within strings only
	showtabs=false,                  % show tabs within strings adding particular underscores
	stepnumber=1,                    % the step between two line-numbers. If it's 1, each line will be numbered
	stringstyle=\color{mymauve},     % string literal style
	tabsize=2,	                   % sets default tabsize to 2 spaces
	%title=\lstname                   % show the filename of files included with \lstinputlisting; also try caption instead of title
}

\lstset{basicstyle=\small\ttfamily }

%%% For proofs 
\newtheorem{definition}{Definition}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{hypothesis}{Hypothesis}
\newtheorem{corollary}{Corollary}
\newtheorem*{remark}{Remark}
\newtheorem{invariant}{Invariant}
\renewcommand\qedsymbol{$\blacksquare$}
\newenvironment{myproof}{{\bf Proof:}}{\hfill\rule{2mm}{2mm}}

\newrefformat{fig}{Figure~\ref{#1}}
\newrefformat{tab}{Table~\ref{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\pref}[1]{\prettyref{#1}}
\newcommand{\Pref}[1]{\prettyref{#1} \vpageref[]{#1}}
\newcommand{\ppref}[1]{\vpageref[]{#1}}



%%%% For Color
%\definecolor{dark-gray}{gray}{0.2}
%\definecolor{mygreen}{rgb}{0,0.6,0}
%\definecolor{mygray}{rgb}{0.5,0.5,0.5}
%\definecolor{mymauve}{rgb}{0.58,0,0.82}
%\definecolor{myblue}{HTML}{144B7D}

%%%% For the new operator
\DeclareMathOperator*{\bigJoin}{\scalerel*{\Join}{\sum}}
\newcommand*{\LargerCdot}{\raisebox{0.25ex}{\scalebox{0.7}{$\bullet$}}}
\newcommand\cons{\LargerCdot}
\newcommand{\doubleplus}{{+\kern-1.3ex+\kern0.8ex}}

%%% general
\newcommand\ignore[1]{}
\newcommand{\eg}{{\em e.g.}}
\newcommand{\etc}{{\em etc.}}
\newcommand{\ie}{{\em i.e.}}
\newcommand{\cf}{{\em c.f.}}
\newcommand{\etal}{{\em et al.}}
\newcommand{\code}[1]{{\texttt{#1}}}
\newcommand{\codeinmath}[1]{{\mathrm{\texttt{#1}}}}
\newcommand\nil{\codeinmath{nil}}
\newcommand{\para}[1]{\paragraph{#1}}

\newcommand\set[1]{\{#1\}}

\newcommand{\bfalse}{{\codeinmath{false}}}
\newcommand{\btrue}{{\codeinmath{true}}}
\newcommand{\toptype}{{\top_{\codeinmath{TYPE}}}}
\newcommand{\nattype}{{\mathbb{N}}}
\newcommand{\booltype}{{\mathbb{B}}}
\newcommand{\ztype}{{\mathbb{Z}}}
\newcommand{\optionsome}{{\Some}}
\newcommand{\optionnone}{{\None}}
\newcommand{\nulllist}{{\nil}}
\newcommand{\listcons}[2]{{{#1}\cons{#2}}}
\newcommand{\listconsoppo}[2]{{{#2}\cons{#1}}}
\newcommand{\listapp}[2]{{{#1}\doubleplus{#2}}}
\newcommand{\listappoppo}[2]{{{#2}\doubleplus{#1}}}
\newcommand\zmapfunc{\codeinmath{ZMap}}

\newcommand\None{\codeinmath{None}}
\newcommand\Some{\codeinmath{Some}}
\newcommand\optiondef{\codeinmath{option}}

\newcommand{\listconstructorkwd}{\mathrm{lst}}
\newcommand{\listconstructor}[1]{{\listconstructorkwd \ {#1}}}

%%% Names 
\newcommand{\intelmachine}{\mathrm{x86}}
\newcommand{\clight}{\mathrm{clight}}
\newcommand{\compcert}{\mathrm{CompCert}}
\newcommand{\compcertx}{\mathrm{CompCertX}}
\newcommand{\certikos}{\mathrm{CertiKOS}}
\newcommand{\calname}{\mathrm{CAL}}

\newcommand{\ccalname}{\mathrm{CCAL}}
\newcommand{\caspaxos}{\mathrm{CASPaxos}}
\newcommand{\coq}{\mathrm{Coq}}
\newcommand{\paxos}{\mathrm{Paxos}}
\newcommand{\multipaxos}{\mathrm{MultiPaxos}}
\newcommand{\raft}{\mathrm{Raft}}
\newcommand{\verdi}{\mathrm{Verdi}}
\newcommand{\selfour}{\mathrm{SeL4}}
\newcommand{\rgsimname}{\mathrm{RGSim}}
\newcommand{\mcsname}{\mathrm{MCS}}
\newcommand{\ocamlname}{\mathrm{OCaml}}
\newcommand{\WOR}{\mathrm{WOR}}
\newcommand{\wormspace}{\mathrm{WormSpace}}

\newcommand{\lasm}{\mathrm{LAsm}}
\newcommand{\easm}{\mathrm{EAsm}}
\newcommand{\ieasm}{\mathrm{IEAsm}}

\newcommand{\tasm}{\mathrm{TAsm}}
\newcommand{\hasm}{\mathrm{HAsm}}

\newcommand{\machkwd}{\codeinmath{Mach}}
\newcommand{\localmachkwd}{\codeinmath{LMach}}

\newcommand{\lasmmach}{\machkwd_{\lasm}}
\newcommand{\easmmach}{\machkwd_{\easm}}
\newcommand{\tasmmach}{\machkwd_{\tasm}}
\newcommand{\hasmmach}{\machkwd_{\hasm}}
\newcommand{\ieasmmach}{\machkwd_{\ieasm}}


\newcommand{\ignorechar}{\_}
%%%%

%%%%%%%% MEMORY
\newcommand{\memintregulartype}{\codeinmath{Mint32}}

\newcommand{\memkwd}{\codeinmath{Mem}}
\newcommand{\loadinmemkwd}{\codeinmath{load}}
\newcommand{\memloadkwd}{\memkwd . \loadinmemkwd}
\newcommand{\memloadnoeq}[4]{\memloadkwd ~~{#1}~~ {#2} ~~ {#3} ~~ {#4}}
\newcommand{\memloadsome}[5]{\memloadnoeq{#1}{#2}{#3}{#4}={\Some}~~{#5}}
\newcommand{\memloadnone}[4]{\memloadnoeq{#1}{#2}{#3}{#4}~=~{\None}}

\newcommand{\accessinmemkwd}{\codeinmath{valid\_access}}
\newcommand{\memaccesskwd}{\memkwd . \accessinmemkwd}
\newcommand{\memaccess}[3]{\memaccesskwd ~~{#1} ~~ {#2} ~~ {#3}}


%%%%%%%%%%%%%%%%
%% COMMENTS 
\newif \ifcomments \commentsfalse

\ifcomments
\newcommand{\zhong}[1]{\textbf{\textcolor{red}{[ #1 --Zhong]}}}
\newcommand{\jieung}[1]{\textbf{\textcolor{blue}{[ #1 -- Jieung]}}}

\else
\newcommand{\zhong}[1]{}
\newcommand{\jieung}[1]{}

\fi
%% END COMMENTS
%%%%%%%%%%%%%%%%%%%%%%






%%%%%%%%%%%%%% FROM CCAL 

%\newcommand\layer[3]{(#1,#2,#3)}


% Typing judgements
\newcommand{\sem}[2]{[\![{#1} \langle {#2} \rangle]\!]}
\newcommand{\semwmachine}[3]{{\sem{#1}{#2}}_{#3}}
\newcommand{\oracle}{{\varepsilon}}
\newcommand{\Layer}{\mathcal{L}}
\newcommand{\Rely}{\mathcal{R}}
\newcommand{\Guard}{\mathcal{G}}
\newcommand{\id}{\textbf{id}}
\newcommand{\ltyp}[4]{#1 \vdash_{#2} #3 : #4}
\newcommand{\lltyp}[5]{#2 \vdash^{#1}_{#3} #4 : #5}
\newcommand{\refines}{\sqsubseteq} % refinement relation
\newcommand{\modulecomposekwd}{\oplus}
\newcommand{\modulecompose}[2]{{#1} \modulecomposekwd {#2}}
\newcommand{\relcomposekwd}{\circ}
\newcommand{\relcompose}[2]{{#1} \relcomposekwd {#2}}
\newcommand\parallelcomposekwd{\!\bowtie\!}
\newcommand{\parallelcompose}[2]{{#1} \parallelcomposekwd {#2}}


\newcommand\spec{\sigma}
\newcommand\PLayer[3]{#1[#2, #3]}

\newcommand\regs{\rho}
\newcommand\state{s}
\newcommand\emptye{\epsilon}
\newcommand{\strat}[1]{\varphi_{#1}}
\newcommand{\stratp}[1]{\varphi'_{#1}}

\newcommand\replay{\mathbb{R}}
\newcommand\switch{\!\Rightarrow\!}


%------------------------ FOR Section 2

\newcommand\push{\codeinmath{push}}
\newcommand\pull{\codeinmath{pull}}
\newcommand\incticket{\codeinmath{FAI}}


%%%%%%%%%%%%%% FROM MCSLOCK

\newcommand{\swaptail}[2]{\codeinmath{SWAP\_TAIL}~{#1}~{#2}}
\newcommand\SWAPTAIL{\codeinmatht{SWAP\_TAIL}}
\newcommand\FAS{\codeinmath{FAS}}
\newcommand\CAS{\codeinmath{CAS}}
\newcommand{\castail}[1]{\codeinmath{CAS\_TAIL}~{#1}}

\newcommand{\getnext}{\codeinmath{GET\_NEXT}}
\newcommand{\setnext}[1]{\codeinmath{SET\_NEXT}~{#1}}
\newcommand\SETNEXT{\codeinmath{SET\_NEXT}}

\newcommand{\getbusy}[1]{\codeinmath{GET\_BUSY}~{#1}}
\newcommand\GETBUSY{\codeinmath{GET\_BUSY}}

\newcommand{\setbusy}{\codeinmath{SET\_BUSY}}
\newcommand{\invalidmcsval}{\codeinmath{TOTAL\_CPU}}
\newcommand{\rellock}{\codeinmath{REL\_LOCK}}
\newcommand{\waitlock}[1]{\codeinmath{WAIT\_LOCK}~{#1}}
\newcommand{\WAITLOCK}{\codeinmath{WAIT\_LOCK}}

\newcommand{\mcstshared}[1]{\codeinmath{TSHARED}~{#1}}


\newcommand{\mmcsboot}{\codeinmath{Boot}}
\newcommand{\mmcslockintro}{\codeinmath{Intro}}
\newcommand{\mmcslockabsintro}{\codeinmath{AbsIntro}}
\newcommand{\mmcslockop}{\codeinmath{LkOp}}
\newcommand{\mqmcslockop}{\codeinmath{QLkOp}}
\newcommand{\mhmcslockop}{\codeinmath{HLkOp}}

\newcommand{\mmcsbootfull}{\codeinmath{MBoot}}
\newcommand{\mmcslockintrofull}{\codeinmath{MMCSLockIntro}}
\newcommand{\mmcslockabsintrofull}{\codeinmath{MMCSLockAbsIntro}}
\newcommand{\mmcslockopfull}{\codeinmath{MMCSLockOp}}
\newcommand{\mqmcslockopfull}{\codeinmath{MQMCSLockOp}}
\newcommand{\mhmcslockopfull}{\codeinmath{MHMCSLockOp}}



\newcommand\LEMPTY{\codeinmath{LEMPTY}}
\newcommand\LHOLD{\codeinmath{LHOLD}}

\newcommand{\mcsacquire}{\codeinmath{mcs\_acquire}}
\newcommand{\mcsrelease}{\codeinmath{mcs\_release}}

\newcommand{\waitlockfunc}{\codeinmath{wait\_lock}}
\newcommand{\passlockfunc}{\codeinmath{pass\_lock}}

\newcommand{\mcswaitlockfunc}{\codeinmath{mcs\_wait\_lock}}
\newcommand{\mcspasslockfunc}{\codeinmath{mcs\_pass\_lock}}

\newcommand{\mcsswaptailabs}{\codeinmath{mcs\_swap\_tail}}
\newcommand{\mcssetnextabs}{\codeinmath{mcs\_set\_next}}
\newcommand{\mcsgetbusyabs}{\codeinmath{mcs\_get\_busy}}
\newcommand{\mcslog}{\codeinmath{mcs\_log}}

\newcommand{\mcssetnext}{\codeinmath{mcs\_SET\_NEXT}}


\newcommand{\atomicmcslog}{\codeinmath{atomic\_mcs\_log}}
\newcommand{\atomicmcsswap}{\codeinmath{atomic\_mcs\_SWAP}}
\newcommand{\atomicmcscas}{\codeinmath{atomic\_mcs\_CAS}}
\newcommand{\mcsinitnodelog}{\codeinmath{mcs\_init\_node\_log}}
\newcommand{\mcsgetnextlog}{\codeinmath{mcs\_GET\_NEXT\_log}}
\newcommand{\mcssetnextlog}{\codeinmath{mcs\_SET\_NEXT\_log}}
\newcommand{\mcsgetbusylog}{\codeinmath{mcs\_GET\_BUSY\_log}}
\newcommand{\mcssetbusylog}{\codeinmath{mcs\_SET\_BUSY\_log}}


\newcommand{\lockmemloc}{\codeinmath{LK}}
\newcommand{\lockabsloc}{\codeinmath{MCSLock}}
\newcommand{\lockmultilogpool}{\codeinmath{multi\_log}}
\newcommand{\lockmultilog}{\codeinmath{MULTILOG}}

\newcommand{\matchmcslock}{\codeinmath{match\_MCSLOCK}}

\newcommand{\calmcslock}{\codeinmath{CalMCSLock}}
\newcommand\CalBound{\codeinmath{CalBound}}
\newcommand\QSCalLock{\codeinmath{QS\_CalLock}}
\newcommand\CalWaitGet{\codeinmath{CalWaitGet}}
\newcommand{\calmcsacqwait}{\codeinmath{CalMCS\_AcqWait}}
\newcommand{\CalWaitLockTime}{\codeinmath{CalWaitLockTime}}
\newcommand{\BoundValAux}{\codeinmath{BoundValAux}}
\newcommand\QCalMCSLock{\codeinmath{Q\_CalMCSLock}}
\newcommand\HCalLock{\codeinmath{H\_CalLock}}

\newcommand{\mcslempty}{\codeinmath{LEMPTY}}
 \newcommand{\mcslhold}{\codeinmath{LHOLD}}
 \newcommand{\mcsmeasure}{\codeinmath{Msr}}

\newcommand{\waitqslockspec}{\codeinmath{wait\_qslock\_spec}}
\newcommand{\passqslockspec}{\codeinmath{pass\_qslock\_spec}}

\newcommand{\mcsacquirespec}{\codeinmath{mcs\_acquire\_spec}}
\newcommand{\mcswaithlockspec}{\codeinmath{wait\_hlock\_spec}}
\newcommand{\mcspasshlockspec}{\codeinmath{pass\_hlock\_spec}}
\newcommand{\mcslockown}{\codeinmath{LockOwn}}
\newcommand{\mcsockfalse}{\codeinmath{LockFalse}}
\newcommand{\mcslockabsfield}{\codeinmath{lock}}
\newcommand{\mcsabsdata}{\codeinmath{RData}}
\newcommand{\zeqkwd}{\codeinmath{zeq}}
\newcommand{\zeqop}[2]{\zeqkwd \ {#1} \ {#2}}
\newcommand{\relatemcslogkwd}{\codeinmath{relate\_log}_{(lk, mcs)}}
\newcommand{\relatemcslognoeq}[1]{\relatemcslogkwd({#1})}
\newcommand{\relatemcslog}[2]{\relatemcslognoeq{#1} = {#2}}
\newcommand{\pallocfunc}{\codeinmath{palloc}}
\newcommand{\acquirelockfunc}{\codeinmath{acquire\_lock}}
\newcommand{\releaselockfunc}{\codeinmath{release\_lock}}

\newcommand{\acquirereleaselock}{\codeinmath{acquire}/\codeinmath{release\_lock}}
\newcommand{\releaselockATspec}{\codeinmath{release\_lock\_AT\_spec}}
\newcommand{\acquirereleaselockATspec}{\codeinmath{acquire}/\codeinmath{release\_lock\_AT\_spec}}
\newcommand{\pallocpspec}{\codeinmath{palloc'\_spec}}

\newcommand{\lpallocspec}{\codeinmath{lpalloc\_spec}}
\newcommand{\releaseshared}{\codeinmath{release\_shared}}


\newcommand{\mcsopullev}{\codeinmath{OPULL}}
\newcommand{\mcsoateev}[1]{\codeinmath{OATE}~{#1}}
\newcommand{\mcsOATEev}{\codeinmath{OATE}}

\newcommand{\mcsalloctable}{\codeinmath{AT}}
\newcommand{\mcsalloctabletype}{\codeinmath{ATable}}
\newcommand{\mcsopalloce}{\codeinmath{OPALLOCE}}
\newcommand{\mcsOMEME}{\codeinmath{OMEME}}
\newcommand{\mcsomeme}[1]{\codeinmath{OMEME}~{#1}}

%




%\newcommand\true{\mathrm{\texttt{true}}}
%\newcommand\false{\mathrm{\texttt{false}}}



%%%%%%%%%%%%%% FROM MULTICORE AND MULTITHREADED LINKING
%%%%%
%%%%%
%%%%%   For thread linking - need to check
%%%%%
%%%%%

\newcommand{\hardwaresetting}{\codeinmath{HardwareSetting}}
\newcommand{\hardwaresemantics}{\codeinmath{HWSemantics}}

\newcommand{\threadyieldfunc}{\codeinmath{thread\_yield}}
\newcommand{\threadsleepfunc}{\codeinmath{thread\_sleep}}


\newcommand\join{\!\bowtie\!}

\newcommand{\EAsmM}[1]{\mathsf{EAsm_{#1}}}
\newcommand{\TAsmM}[1]{\mathsf{TAsm_{#1}}}

\newcommand{\dshare}{\mathsf{sa}}
\newcommand{\dproc}{\mathsf{pa}}
\newcommand{\dsnap}{\mathbb{n}\dproc}
\newcommand{\cpuid}{\mathsf{f_{cpu}}}
\newcommand{\procid}{\mathsf{f_{proc}}}
\newcommand{\blocknum}{\mathsf{nb}}

\newcommand{\lval}{\mathsf{Lval}}
\newcommand{\largs}{\mathsf{Largs}}

\newcommand{\primevunit}[1]{\mathsf{EU_{#1}}}
\newcommand{\yieldbackunit}{\mathsf{yieldBack}}
\newcommand{\SLog}{\mathsf{Log}}
\newcommand{\snapfun}{\mathsf{f_{\dsnap}}}

\newcommand{\Sevent}{\mathsf{Ev}}
\newcommand{\threadfunid}{\mathsf{ident}}
\newcommand{\statecheck}{\mathsf{f}_{\mathcal{C}}}

\newcommand{\updatefun}{\mathcal{SR}}
\newcommand{\haseventfun}{\mathsf{f_{evcheck}}}
\newcommand{\threadstate}{\mathsf{ts}}
\newcommand{\nextblockfun}{\mathsf{f_{\blocknum}}}

\newcommand{\initdproc}{\mathsf{f_{init\_pa}}}
\newcommand{\curthread}{\mathsf{CurID}}
\newcommand{\initregs}{\mathsf{f_{init\_regs}}}
\newcommand{\getenvlog}{\mathsf{\varphi^{\curthread}_{[\mathrm{TAsm}]}}}
\newcommand{\composedata}{\mathcal{CD}_{\mathrm{init}}}
\newcommand{\threadset}{{\mathcal{S}_{\mathrm{thrd}}}}
\newcommand{\fullthreadset}{{\mathcal{S}_{\mathrm{T}}}}

%\newcommand{\AsmLM}{\mathsf{Asm}_{\mathrm{L}}}
\newcommand{\AsmLM}{\mathsf{Asm}}
\newcommand{\AsmHM}{\mathsf{Asm}^{\mathrm{t}}}
\newcommand{\simrel}{\mathcal{R}_{\mathrm{sim}}}
\newcommand{\absrel}{\mathcal{AR}^{{_{\EAsmM{}}}}_{_{\AsmLM}}}
\newcommand{\absrelt}{\mathcal{AR}^{{_{\AsmHM}}}_{_{\TAsmM{}}}}
\newcommand{\proofcase}[1]{({Case\ }_{\mathrm{#1}})}


\newcommand\Lpthread{L_\codeinmath{pthread}}


\newcommand{\sstepr}[5]{#1(#2, #3) \ni (#4, #5)}
\newcommand{\sstep}[4]{#1(#2, #3) \ni (#4)}

\newcommand{\nextblockOP}[0]{\mathsf{nb}}
\newcommand{\nextblock}[1]{\nextblockOP({#1})}
\newcommand{\liftnextblockOP}[0]{\mathsf{liftnb}}
\newcommand{\liftnextblock}[2]{\liftnextblockOP({#1}, {#2})}
\newcommand{\extends}[2]{{#1} \subseteq {#2}}
\newcommand{\inject}[3]{{#2} \stackrel{#1}{\hookrightarrow} {#3}}
\newcommand{\alloc}[3]{\mathsf{alloc}({#1}, {#2}, {#3})}
\newcommand{\store}[3]{\mathsf{st}({#1}, {#2}, {#3})}
\newcommand{\load}[2]{\mathsf{ld}({#1}, {#2})}
\newcommand{\some}[1]{\left\lfloor {#1} \right\rfloor}

\newcommand{\disjointunionOP}[0]{\circledast}
\newcommand{\disjointunion}[3]{{#1} \disjointunionOP {#2} \simeq {#3}}
%%%%%
%%%%%
%%%%%   END of Thread Linking
%%%%%
%%%%%
%%%%%


%%%% CALCULUS
\newcommand{\listlengthkwd}{{\mathrm{len_{lst}}}}

\newcommand{\listlengthnoeq}[1]{{\listlengthkwd({#1})}}
\newcommand{\listlength}[2]{{\listlengthnoeq{#1} = {#2}}}


\newcommand{\ccbyte}{{\mathrm{\texttt{byte}}}}
\newcommand{\ccbytes}{{\listconstructor{\ccbyte}}}
\newcommand{\ccmem}{{\mathrm{\texttt{mem}}}}
\newcommand{\ccprivatemem}{{\ccmem}_{\mathrm{\texttt{p}}}}
\newcommand{\ccsharedmem}{{\ccmem}_{\mathrm{\texttt{s}}}}
%
%\newcommand{\ccprivatememorycpuid}[1]{{\ccmemory}_{\mathrm{\texttt{cpu}}{#1}}}
%


\newcommand{\ccval}{{\mathrm{\texttt{val}}}}
\newcommand{\ccvalintkwd}[1]{{\mathrm{\texttt{Vint}~{#1}}}}
\newcommand{\ccintval}{{\mathrm{\texttt{val}}_{\mathrm{\texttt{int}}}}}
\newcommand{\ccvalptrkwd}[2]{{\mathrm{\texttt{Vptr}~{#1}~{#2}}}}

\newcommand{\ccvundef}{{\mathrm{\texttt{Vundef}}}}
\newcommand{\ccvint}[1]{{\mathrm{\texttt{Vint}}~{#1}}}
\newcommand{\cpuident}{{\mathrm{ID}_\mathrm{cpu}}}


\newcommand{\ccregisterpc}{{\mathrm{\texttt{PC}}}}
\newcommand{\ccregisterebx}{{\mathrm{\texttt{EBX}}}}
\newcommand{\ccregistereax}{{\mathrm{\texttt{EAX}}}}
\newcommand{\ccregister}{{\mathrm{\texttt{reg}}}}

\newcommand{\ccregisterset}{{\rho}}

\newcommand{\absstatekwd}{{\mathrm{\texttt{a}}}}
\newcommand{\ccprivateabsstate}{{\absstatekwd_{\mathrm{\texttt{p}}}}}
\newcommand{\ccsharedabsstate}{{\absstatekwd_{\mathrm{\texttt{s}}}}}
%\newcommand{\ccprivateabsstatecpuid}[1]{{\absstate_{\mathrm{\texttt{cpu}}{#1}}}}
\newcommand{\ccmemloc}{{\mathrm{\texttt{loc}}}}
\newcommand{\ccmemvallength}{{\mathrm{\texttt{vlen}}}}


\newcommand{\cpueventkwd}{{\mathrm{\texttt{ev}}}_{\mathrm{\texttt{CPU}}}}
\newcommand{\cpulogkwd}{{\mathrm{\texttt{log}}_{\mathrm{\texttt{CPU}}}}}


\newcommand{\replayfunckwd}{{\mathbb{R}_\mathrm{cpu}}}
\newcommand{\replayfuncnoeq}[1]{{\replayfunckwd({#1})}}
\newcommand{\replayfunc}[2]{{\replayfuncnoeq{#1} = {#2}}}

\newcommand{\cpuasminst}{{\mathrm{\texttt{x86instr}}}}
\newcommand{\cpuasmfunc}{{\mathrm{\texttt{Func}_{x86}}}}
\newcommand{\cpuasmmodule}{{\mathrm{\texttt{M}_{x86}}}}
\newcommand{\cpuprivatestate}{{\mathrm{\texttt{pst}}_{\mathrm{\texttt{CPU}}}}}
\newcommand{\cpuprivatestatecon}[3]{{({#1}, {#2}, {#3})}}

\newcommand{\cpuprivatestatepool}{{\mathrm{P}_{\cpuprivatestate}}}
\newcommand{\cpustatekwd}{{\mathrm{\texttt{st}}_{\mathrm{\texttt{CPU}}}}}
\newcommand{\cpustatecon}[4]{{({#1}, {#2}, {#3}, {#4})}}

\newcommand{\primitivespeckwd}{\sigma_{p}}

\newcommand{\cpulayerprimdef}{{\mathcal{L}}}

\newcommand{\cpulayerinvariantkwd}{{\mathcal{I}nv}}

\newcommand{\cpurely}[1]{{\mathcal{R}_{\mathrm{\texttt{cpu}[{#1}]}}}}
\newcommand{\cpuguarantee}[1]{{\mathcal{G}_{\mathrm{\texttt{cpu}[{#1}]}}}}

\newcommand{\cpuenvcontextkwd}{{\varepsilon_{\mathrm{\texttt{cpu}}}}}
\newcommand{\cpuenvcontext}[1]{{\varepsilon_{\mathrm{\texttt{cpu}}}({#1})}}

\newcommand{\cpulayerdefkwd}[1]{{\mathrm{\texttt{L}}[{#1}]}}
\newcommand{\cpulayerdefcon}[4]{{({#1}, {#2}, {#3}, {#4})}}

\newcommand{\cpuglobalenv}{{\mathrm{\texttt{Genv}}}}


%keyword
%\newcommand{\set}[1]{\{#1\}}
%\newcommand{\compcertx}{\textrm{CompCertX}}


%type



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
% for CompCertX
%%%%%%%%%%%
%Inductive eventval: Type :=
%  | EVint: int -> eventval
%  | EVlong: int64 -> eventval
%  | EVfloat: float -> eventval
%  | EVfloatsingle: float -> eventval
%  | EVptr_global: ident -> int -> eventval.
%


%Inductive memory_chunk : Type :=
%  | Mint8signed     (**r 8-bit signed integer *)
%  | Mint8unsigned   (**r 8-bit unsigned integer *)
%  | Mint16signed    (**r 16-bit signed integer *)
%  | Mint16unsigned  (**r 16-bit unsigned integer *)
%  | Mint32          (**r 32-bit integer, or pointer *)
%  | Mint64          (**r 64-bit integer *)
%  | Mfloat32        (**r 32-bit single-precision float *)
%  | Mfloat64.        (**r 64-bit double-precision float *)


%Inductive event: Type :=
%  | Event_syscall: ident -> list eventval -> eventval -> event
%  | Event_vload: memory_chunk -> ident -> int -> eventval -> event
%  | Event_vstore: memory_chunk -> ident -> int -> eventval -> event
%  | Event_annot: ident -> list eventval -> event.
%
%(** The dynamic semantics for programs collect traces of events.
%  Traces are of two kinds: finite (type [trace]) or infinite (type [traceinf]). *)
%
%Definition trace := list event.
%%%%%%%%%

\newcommand{\cceventval}{{\mathrm{\texttt{eventval}}_{cc}}}
\newcommand{\ccevent}{{\mathrm{\texttt{event}}_{cc}}}
\newcommand{\ccevintkwd}{{\mathrm{\texttt{EVint}}}}
\newcommand{\ccevlongkwd}{{\mathrm{\texttt{EVlong}}}}
\newcommand{\ccevfloatkwd}{{\mathrm{\texttt{EVfloat}}}}
\newcommand{\ccevfloatsinglekwd}{{\mathrm{\texttt{EVfloatsingle}}}}
\newcommand{\ccevptrglobalkwd}{{\mathrm{\texttt{EVptr}}\_\mathrm{\texttt{global}}}}

\newcommand{\cctracekwd}{{\mathrm{\texttt{trace}}_{cc}}}
\newcommand{\ccemptytrace}{{\mathrm{E}_0}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
% MULTICORE LINKING PART
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5


\newcommand\Compose[3]{\codeinmath{compat}(#1, #2, #3)}

% syntax 

\newcommand{\privatestate}{{\rho_{mc}}}
\newcommand{\privatestatepoolkwd}{{\codeinmath{psp}}}
\newcommand{\privatestatepool}[1]{{{\privatestatepoolkwd}_{[#1]}}}
\newcommand{\sharedpiece}{{\varsigma_{mc}}}
\newcommand{\atomicevent}{{\codeinmath{\textbf{\textit{e}}}_{\codeinmath{atom}}}}
\newcommand{\primitiveid}{{\codeinmath{ID}_{pr}}}
\newcommand{\atomiceventidentkwd}{{\codeinmath{GetID}_{\codeinmath{atom}}}}
\newcommand{\atomiceventident}[1]{{\codeinmath{GetID}_{\codeinmath{atom}}({#1})}}

\newcommand{\coreset}{{\mathbb{S}_{core}}}
\newcommand{\schedid}{{\codeinmath{ID}_{sched}}}

\newcommand{\command}{{\codeinmath{\textbf{\textit{cmd}}}_{\codeinmath{mc}}}}
\newcommand{\mcevent}{{\codeinmath{\textbf{\textit{ev}}}_{mc}}}
\newcommand{\mclog}{{\codeinmath{\textbf{\textit{log}}}_{\mathrm{mc}}}}
\newcommand{\mcoraclekwd}{{\varepsilon_{mc}}}
\newcommand{\mcoracle}[3]{{{\mcoraclekwd}_{[{#1}, {#2}, {#3}]}}}
\newcommand{\ogetkwd}{{\codeinmath{\textbf{oget}}}}
\newcommand{\ogetnoeq}[5]{{\ogetkwd_{[{#1}, {#2}, {#3}]}({#4}, {#5})}}
\newcommand{\oget}[6]{{\ogetnoeq{#1}{#2}{#3}{#4}{#5} = \optionsome \ {#6}}}


%event and command 
\newcommand{\privatecmdkwd}{{\codeinmath{PRIVATE}}}
\newcommand{\atomiccmdkwd}{{\codeinmath{ATOMIC}}}
\newcommand{\atomiccmd}[2]{{\atomiccmdkwd\langle{#1}, {#2}\rangle}}
\newcommand{\acqsharedcmdkwd}{{\codeinmath{ACQ}\_\codeinmath{SHARED}}}
\newcommand{\acqsharedcmd}[1]{{\acqsharedcmdkwd\langle{#1}\rangle}}
\newcommand{\relsharedcmdkwd}{{\codeinmath{REL}\_\codeinmath{SHARED}}}
\newcommand{\relsharedcmd}[1]{{\relsharedcmdkwd\langle{#1}\rangle}}


\newcommand{\yieldevkwd}{{\codeinmath{EYIELD}}}
\newcommand{\yieldev}[1]{{\yieldevkwd\langle{#1}\rangle}}
\newcommand{\yieldbackevkwd}{{\codeinmath{EBACK}}}
\newcommand{\yieldbackev}[1]{{\yieldbackevkwd\langle{#1}\rangle}}
\newcommand{\acqevkwd}{{\codeinmath{EACQ}}}
\newcommand{\acqev}[2]{{\acqevkwd\langle{#1}, {#2}\rangle}}
\newcommand{\relevkwd}{{\codeinmath{EREL}}}
\newcommand{\relev}[3]{{\relevkwd\langle{#1}, {#2}, {#3}\rangle}}
\newcommand{\atomicevkwd}{{\codeinmath{EATOMIC}}}
\newcommand{\atomicev}[3]{{\atomicevkwd\langle{#1}, {#2}, {#3}\rangle}}

% semantics 
\newcommand{\mcprop}{{\codeinmath{P}}}
\newcommand{\optioncmd}[1]{{\codeinmath{option}~{#1}}}

\newcommand{\programcounterkwd}{{\codeinmath{\textbf{PC}}}}
\newcommand{\programcounter}[2]{{\programcounterkwd \ {#1} \ {#2}}}
\newcommand{\privatestepkwd}{{{\codeinmath{Eval}_{\codeinmath{private}}}}}
\newcommand{\privatestep}[3]{{\privatestepkwd \ {#1} \ {#2} \ {#3}}}
\newcommand{\getsharedstepkwd}{{\codeinmath{Eval}_{\codeinmath{get}}}}
\newcommand{\getsharedstep}[3]{{\getsharedstepkwd \ {#1} \ {#2} \ {#3}}}
\newcommand{\setsharedstepkwd}{{\codeinmath{Eval}_{\codeinmath{set}}}}
\newcommand{\setsharedstep}[3]{{\setsharedstepkwd \ {#1} \ {#2} \ {#3}}}
\newcommand{\atomicstepkwd}{{\codeinmath{Eval}_{\codeinmath{atom}}}}
\newcommand{\atomicstep}[6]{{\atomicstepkwd \ {#1} \ {#2} \ {#3} \ {#4} \ {#5} \ {#6}}}
\newcommand{\loggetatomkwd}{{\codeinmath{lget}_{\codeinmath{atom}}}}
\newcommand{\loggetatomnoeq}[2]{{\loggetatomkwd({#1}, {#2})}}
\newcommand{\loggetatom}[3]{{\loggetatomnoeq{#1}{#2} = {#3}}}

% hardware local step related definitions 
\newcommand{\ofreekwd}{{\codeinmath{OFREE}}}
\newcommand{\ofreestate}[1]{{\ofreekwd\langle{#1}\rangle}}
\newcommand{\ownkwd}{{\codeinmath{OWN}}}
\newcommand{\ownstate}[1]{{\ownkwd\langle{#1}\rangle}}
\newcommand{\ownstatekwd}{{\codeinmath{Owner}}}

\newcommand{\hstatekwd}{{\codeinmath{hstate}}}
\newcommand{\hstateconkwd}{{\codeinmath{HState}}}
\newcommand{\hstate}[3]{{\hstateconkwd \ {#1} \ {#2}\ {#3}}}
\newcommand{\localviewkwd}{{\codeinmath{view}_{\codeinmath{l}}}}
\newcommand{\localviewconkwd}{{\codeinmath{LView}}}
\newcommand{\localview}[2]{{\localviewconkwd \ {#1} \ {#2}}}
\newcommand{\calownerkwd}{{\codeinmath{CalOwner}}}
\newcommand{\calowner}[3]{{\calownerkwd({#1},{#2})={#3}}}

\newcommand{\hardwarelocalstep}[3]{{{\localmachkwd}_{{\codeinmath{CPU}}} \ {#1}\ {#2}\ {#3}}}

\newcommand{\getpstkwd}{{\codeinmath{getPST}}}
\newcommand{\getpstnoeq}[3]{{\getpstkwd_{[{#1}]}~({#2},\ {#3})}}
\newcommand{\getpstsome}[4]{{\getpstnoeq{#1}{#2}{#3} = \optionsome \ {#4}}}
\newcommand{\getpstnone}[3]{{\getpstnoeq{#1}{#2}{#3}   = \optionnone}}

\newcommand{\setpstkwd}{{\codeinmath{setPST}}}
\newcommand{\setpstnoeq}[4]{{\setpstkwd_{[{#1}]}~({#2}, \ {#3}, \ {#4})}}
\newcommand{\setpst}[5]{{\setpstnoeq{#1}{#2}{#3}{#4} = {#5}}}


\newcommand{\hardwarestepkwd}{{{{\machkwd}_\codeinmath{mc}}}}
\newcommand{\hardwarestep}[4]{{\hardwarestepkwd~{#1}~{#2}~{#3}~{#4}}}


% for oracle fairness
\newcommand{\timebound}{{\lceil{\codeinmath{T}}\rceil}}
\newcommand{\yieldbackfunckwd}{{\codeinmath{AbsYBack}}}
\newcommand{\yieldbackfuncnoeq}[5]{{\yieldbackfunckwd_{#1}({#2},{#3},{#4},{#5})}}

\newcommand{\yieldbackfunc}[6]{{\yieldbackfuncnoeq{#1}{#2}{#3}{#4}{#5} = \optionsome\ {#6}}}


% for oracle step
\newcommand{\localstatekwd}{{\codeinmath{state}_{\codeinmath{l}}}}
\newcommand{\localstatepool}[1]{{\codeinmath{lsp}_{[#1]}}}
\newcommand{\localstateconkwd}{{\codeinmath{LState}}}
\newcommand{\localstate}[2]{{\localstateconkwd~{#1}~{#2}}}

\newcommand{\mcstatekwd}{{\codeinmath{state}}}
\newcommand{\mcstateconkwd}{{\codeinmath{State}}}
\newcommand{\mcstate}[3]{{\mcstateconkwd \ {#1} \ {#2}\ {#3}}}


\newcommand{\oraclestepkwd}{{{{\machkwd}_{\codeinmath{hworacle}}}}}
\newcommand{\oraclestep}[4]{{\oraclestepkwd~{#1}~{#2}~{#3}~{#4}}}


% for env step

\newcommand{\envstatekwd}{{\codeinmath{estate}}}
\newcommand{\envstateconkwd}{{\codeinmath{EState}}}
\newcommand{\envstate}[4]{{\envstateconkwd_{[{#1}]}~{#2}~{#3}~{#4}}}
\newcommand{\envstepkwd}{{{\machkwd}_{\codeinmath{env}}}}
\newcommand{\envstep}[5]{{\envstepkwd_{[{#1}]}~{#2}~{#3}~{#4}~{#5}}}
\newcommand{\backidkwd}{{\codeinmath{backID}}}
\newcommand{\backid}[3]{{\backidkwd({#1}, {#2}) = {#3}}}

% for single, single big, single big2 step
\newcommand{\singlestatekwd}{{\codeinmath{state}_{\codeinmath{si}}}}
\newcommand{\singlestateconkwd}{{\codeinmath{SState}}}
\newcommand{\singlestate}[3]{{\singlestateconkwd~{#1}~{#2}~{#3}}}
\newcommand{\singlestepkwd}{{{{\machkwd}_{\codeinmath{si}}}}}
\newcommand{\singlestep}[5]{{\singlestepkwd_{[{#1}]}~{#2}~{#3}~{#4}~{#5}}}

\newcommand{\singlebigstepkwd}{{{\machkwd}_{\codeinmath{si\_big}}}}
\newcommand{\singlebigstep}[5]{{\singlebigstepkwd_{[{#1}]}~{#2}~{#3}~{#4}~{#5}}}


\newcommand{\rstatekwd}{{\codeinmath{rstate}}}
\newcommand{\rstateconkwd}{{\codeinmath{RState}}}
\newcommand{\rstate}[2]{{\rstateconkwd~{#1}~{#2}}}
\newcommand{\singlebigtwostepkwd}{{{\machkwd}_{\codeinmath{si\_big}'}}}
\newcommand{\singlebigtwostep}[5]{{\singlebigtwostepkwd_{[{#1}]}~{#2}~{#3}~{#4}~{#5}}}

% split step and reorder step

\newcommand{\singlelocalviewkwd}{{\codeinmath{view}_{\codeinmath{si}\_\codeinmath{l}}}}
\newcommand{\singlelocalviewconskwd}{{\codeinmath{SView}}}
\newcommand{\singlelocalview}[1]{{\singlelocalviewconskwd~{#1}}}
\newcommand{\singlelocalstepkwd}{{{\localmachkwd}_{\codeinmath{CPU}_{\codeinmath{local}}}}}
\newcommand{\singlelocalstep}[3]{{\singlelocalstepkwd~{#1}~{#2}~{#3}}}

\newcommand{\singlelogstepkwd}{{{\localmachkwd}_{\codeinmath{CPU}_{\codeinmath{log}}}}}
\newcommand{\singlelogstep}[3]{{\singlelogstepkwd~{#1}~{#2}~{#3}}}

\newcommand{\srstatekwd}{{\codeinmath{srstate}}}
\newcommand{\srstateconkwd}{{\codeinmath{SRState}}}
\newcommand{\srstate}[3]{{\srstateconkwd~{#1}~{#2}~{#3}}}
\newcommand{\singlesplitstepkwd}{{{\machkwd}_{\mathrm{split}}}}
\newcommand{\singlesplitstep}[5]{{\singlesplitstepkwd_{[{#1}]}~{#2}~{#3}~{#4}~{#5}}}

\newcommand{\singlereorderstepkwd}{{{\machkwd}_{\codeinmath{reorder}}}}
\newcommand{\singlereorderstep}[5]{{\singlereorderstepkwd_{[{#1}]}~{#2}~{#3}~{#4}~{#5}}}


% separate step

\newcommand{\separateeventkwd}{{\mcevent_{\codeinmath{sep}}}}
\newcommand{\separateacqevkwd}{{\codeinmath{SEACQ}}}
\newcommand{\separateacqev}[1]{{\separateacqevkwd\langle{#1}\rangle}}
\newcommand{\separaterelevkwd}{{\codeinmath{SEREL}}}
\newcommand{\separaterelev}[2]{{\separaterelevkwd\langle{#1}, {#2}\rangle}}
\newcommand{\separateatomicevkwd}{{\codeinmath{SEATOMIC}}}
\newcommand{\separateatomicev}[2]{{\separateatomicevkwd\langle{#1},{#2}\rangle}}

\newcommand{\separatelogtypekwd}{{\mclog_{\codeinmath{sep}}}}
\newcommand{\separatelogkwd}{{\overline{\separatelogtypekwd}}}
\newcommand{\separateoraclelogtypekwd}{{\mathcal{O}_{\separatelogtypekwd}}}

\newcommand{\spstatekwd}{{\codeinmath{state}_{\codeinmath{sep}}}}
\newcommand{\spstateconkwd}{{\codeinmath{SPState}}}
\newcommand{\spstate}[2]{{\spstateconkwd~{#1}~{#2}}}

\newcommand{\separatelogstepkwd}{{{\localmachkwd}_{\separatelogtypekwd}}}
\newcommand{\separatelogstep}[5]{{\separatelogstepkwd~{#1}~{#2}~{#3}~{#4}~{#5}}}

\newcommand{\separateeventtwoeventkwd}{{{\codeinmath{Get}\mcevent}_{_{\separateeventkwd}}}}
\newcommand{\separateeventtwoeventnoeq}[2]{{\separateeventtwoeventkwd({#1}, {#2})}}
\newcommand{\separateeventtwoevent}[3]{\separateeventtwoeventnoeq{#1}{#2} = {#3}}

\newcommand{\separatelogtwologkwd}{{\codeinmath{Get}\mclog}_{_{\separatelogtypekwd}}}
\newcommand{\separatelogtwolognoeq}[2]{{\separatelogtwologkwd({#1}, {#2})}}
\newcommand{\separatelogtwolog}[3]{\separatelogtwolognoeq{#1}{#2} = {#3}}

\newcommand{\separateeventtwoidkwd}{{\codeinmath{Get}\codeinmath{ID}_{_{\separateeventkwd}}}}
\newcommand{\separateeventtwoidnoeq}[1]{{\separateeventtwoidkwd({#1})}}
\newcommand{\separateeventtwoid}[2]{\separateeventtwoidnoeq{#1}= {#2}}


\newcommand{\acqsharedid}{{\mbox{\textsf{acq}}\_\mbox{shared}}}
\newcommand{\relsharedid}{{\mbox{\textsf{rel}}\_\mbox{shared}}}

\newcommand{\getseplogkwd}{{\codeinmath{getSlog}}}
\newcommand{\getseplognoeq}[2]{{\getseplogkwd({#1},{#2})}}
\newcommand{\getseparatelog}[3]{{\getseplognoeq{#1}{#2} = {#3}}}


\newcommand{\setseplogkwd}{{\codeinmath{setSlog}}}
\newcommand{\setseplognoeq}[3]{{\setseplogkwd({#1},{#2},{#3})}}
\newcommand{\getseplog}[4]{{\setseplognoeq{#1}{#2}{#3} = {#4}}}

\newcommand{\singleseparatestepkwd}{{{\machkwd}_{\codeinmath{sep}}}}
\newcommand{\singleseparatestep}[5]{{\singleseparatestepkwd_{[#1]}~{#2}~{#3}~{#4}~{#5}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
% refinement relations

% generic semantics
\newcommand{\ccplusstepkwd}{{\codeinmath{plus}}}
\newcommand{\ccplusstep}[1]{{\ccplusstepkwd~{#1}}}

\newcommand{\ccstarstepkwd}{{\codeinmath{star}}}
\newcommand{\ccstarstep}[1]{{\ccstarstepkwd~{#1}}}

% valid log 
\newcommand{\eventsourcefunckwd}{{\codeinmath{src}_{\mcevent}}}
\newcommand{\eventsourcefuncnoeq}[1]{{\eventsourcefunckwd({#1})}}
\newcommand{\eventsourcefunc}[2]{{\eventsourcefuncnoeq{#1} = {#2}}}

\newcommand{\eventdesfunckwd}{{\codeinmath{des}_{\mcevent}}}
\newcommand{\eventdesfuncnoeq}[1]{{\eventdesfunckwd({#1})}}
\newcommand{\eventdesfunc}[2]{{\eventdesfuncnoeq{#1} = {#2}}}

\newcommand{\getcuridfromlogkwd}{{\codeinmath{getCid}_{\mclog}}}
\newcommand{\getcuridfromlognoeq}[2]{{\getcuridfromlogkwd({#1}, {#2})}}
\newcommand{\getcuridfromlog}[3]{{\getcuridfromlognoeq{#1}{#2} = {#3}}}


\newcommand{\validlogcheckkwd}{{\codeinmath{check}_{\codeinmath{valid}\_\mathrm{log}}}}
\newcommand{\validlogcheck}[2]{{\validlogcheckkwd~{#1}~{#2}}}

\newcommand{\validlogkwd}{{\codeinmath{valid}_{\codeinmath{log}}}}
\newcommand{\validlog}[2]{{\validlogkwd~{#1}~{#2}}}

\newcommand{\validoraclekwd}{{\codeinmath{valid}_{\codeinmath{EC}}}}
\newcommand{\validoraclenoeq}[3]{\validoraclekwd({#1}, {#2}, {#3})}

%%%% oracle refines hardware

\newcommand{\matchlocalkwd}{{\mathcal{M}_{\codeinmath{local}}}}
\newcommand{\matchlocal}[4]{{\matchlocalkwd~{#1}~{#2}~{#3}~{#4}}}
\newcommand{\matchstatehstatekwd}{{\mathcal{M}_{[\mathrm{st},\mathrm{hst}]}}}
\newcommand{\matchstatehstate}[2]{{\matchstatehstatekwd~{#1}~{#2}}}

%%%% env refines oracle
\newcommand{\matchestatestatekwd}{{\mathcal{M}_{[\mathrm{est}\langle\coreset\rangle,\mathrm{st}]}}}
\newcommand{\matchestatestate}[2]{{\matchestatestatekwd~{#1}~{#2}}}

%%%% env refines env

\newcommand{\mcmeasurekwd}{{\codeinmath{measure}_{\mclog}}}
\newcommand{\mcmeasurenoeq}[1]{{\mcmeasurekwd({#1})}}
\newcommand{\mcmeasure}[2]{{\mcmeasurenoeq{#1} = {#2}}}

\newcommand{\mcstatemeasurekwd}{{\codeinmath{measure}_{\codeinmath{st}_{mc}}}}
\newcommand{\mcstatemeasurenoeq}[2]{{\mcstatemeasurekwd({#1}, {#2})}}
\newcommand{\mcstatemeasure}[3]{{\mcstatemeasurenoeq{#1}{#2} = {#3}}}


\newcommand{\localstepevkwd}{{\codeinmath{l}\_\codeinmath{step}\_\codeinmath{ev}}}
\newcommand{\localstepevnoeq}[1]{{\localstepevkwd({#1})}}
\newcommand{\localstepev}[2]{{\localstepevnoeq{#1} = {#2}}}

\newcommand{\matchestateestatekwd}[1]{{\mathcal{M}_{[\codeinmath{est}\langle{#1}\rangle,\codeinmath{est}\langle\coreset\rangle]}}}
\newcommand{\matchestateestate}[3]{{\matchestateestatekwd{#1}~{#2}~{#3}}}

%%%% single refines env

\newcommand{\matchsinglestatestatekwd}[1]{{\mathcal{M}_{[\codeinmath{sist},\codeinmath{est}\langle{#1}\rangle]}}}
\newcommand{\matchsinglestatestate}[3]{{\matchsinglestatestatekwd{#1}~{#2}~{#3}}}

%%%% big refines single
\newcommand{\matchbsstatesstatekwd}{{\mathcal{M}_{[\codeinmath{bsist},\codeinmath{sist}]}}}
\newcommand{\matchbsstatesstate}[2]{{\matchbsstatesstatekwd~{#1}~{#2}}}

%%%% big2 refines big



\newcommand{\matchrstatesinglestatekwd}{{\mathcal{M}_{[\codeinmath{rst},\codeinmath{sist}]}}}
\newcommand{\matchrstatesinglestate}[3]{{\matchrstatesinglestatekwd~{#1}~{#2}~{#3}}}

%%%% split refines big2

\newcommand{\matchsrstaterstatekwd}{{\mathcal{M}_{[\codeinmath{srst},\codeinmath{rst}]}}}
\newcommand{\matchsrstaterstate}[2]{{\matchsrstaterstatekwd~{#1}~{#2}}}

%%%% reorder refines split 

\newcommand{\validcachelogmemberskwd}{{\codeinmath{validCacheLMem}}}
\newcommand{\validcachelogmembers}[2]{{\validcachelogmemberskwd~{#1}~{#2}}}
\newcommand{\matchrstatesrstatekwd}{{\mathcal{M}_{[\codeinmath{rst},\codeinmath{srst}]}}}
\newcommand{\matchrstatesrstate}[2]{{\matchrstatesrstatekwd~{#1}~{#2}}}

%%%% reorder refines reorder

\newcommand{\mcreducelogfunckwd}{{\codeinmath{redLog}}}
\newcommand{\mcreducelogfuncnoeq}[1]{{\mcreducelogfunckwd({#1})}}
\newcommand{\mcreducelogfunc}[2]{{\mcreducelogfuncnoeq{#1} = {#2}}}

\newcommand{\matchrrstaterrstaekwd}{{\mathcal{M}_{[\codeinmath{rst},\codeinmath{rst}]}}}
\newcommand{\matchrrstaterrstae}[2]{{\matchrrstaterrstaekwd~{#1}~{#2}}}

%%%% separate refines reorder


\newcommand{\removecacheeventkwd}{{\codeinmath{RmvCEv}}}
\newcommand{\removecacheeventnoeq}[2]{{\removecacheeventkwd({#1}, {#2})}}
\newcommand{\removecacheevent}[3]{{\removecacheeventnoeq{#1}{#2} = {#3}}}

\newcommand{\validlogprimkwd}{{\validlogkwd'}}
\newcommand{\validlogprim}[1]{{\validlogprimkwd~{#1}}}
\newcommand{\validoracleprimkwd}{{\validoraclekwd'}}
\newcommand{\validoracleprim}[2]{{\validoracleprimkwd({#1}, {#2})}}

\newcommand{\mcmatchlogskwd}{{\mathcal{M}_{[\separatelogkwd, \mclog]}}}
\newcommand{\mcmatchlogs}[3]{{\mcmatchlogskwd~{#1}~{#2}~{#3}}}

\newcommand{\matchspstaterstatekwd}{{\mathcal{M}_{[\codeinmath{spst},\codeinmath{rst}]}}}
\newcommand{\matchspstaterstate}[3]{{\matchspstaterstatekwd~{#1}~{#2}~{#3}}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
% for linking


\newcommand{\primid}{\primitiveid}
\newcommand{\primspec}[1]{\sigma_{#1}}
\newcommand{\HardWareSetting}{{\hardwaresetting}}
\newcommand{\HardSemantics}{{\hardwaresemantics}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%   MULTITHREADED LINKING
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5



\newcommand{\TLink}{{\codeinmath{TLink}}}
\newcommand{\CSched}{{\codeinmath{CSched}}}
\newcommand{\TSched}{{\codeinmath{TSched}}}
\newcommand{\yield}{\codeinmath{yield}}
\newcommand{\sleep}{\codeinmath{sleep}}
\newcommand{\PBThrd}{{\codeinmath{PBThrd}}}
\newcommand{\PHThrd}{{\codeinmath{PHThrd}}}
\newcommand{\PHBThrd}{{\codeinmath{PHBThrd}}}
\newcommand{\TSyscall}{{\codeinmath{TSyscall}}}


\newcommand{\AbsRelC}{{\codeinmath{AbsRelC}}}
\newcommand{\AbsRelT}{{\codeinmath{AbsRelT}}}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
% LANGUAGES




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
% REFINEMENT


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
% LINKING



%%%%%%% WITNESSPASSING 

%%%% Witness passing related definitions


%\newcommand{\igchar}{\_}
%\newcommand{\sendpkt}[3]{{#1}.\mathrm{SEND}{[#2]}.{#3}}
%\newcommand{\recvpkt}[3]{{#1}.\mathrm{RECV}{[#2]}.{#3}}
\newcommand{\witness}{\varpi}
\newcommand{\updatefunc}{\varrho}
\newcommand{\isquorums}{\mathbb{q}}
%\newcommand{\replay}{\mathbb{R}}

\newcommand{\packet}{{\mathbb{E}_{net}}}
\newcommand{\networklog}{{l_{net}}}
\newcommand{\accsset}{\mathbb{S}_{Ca}}
\newcommand{\voters}{\mathbb{S}_{vtr}}
\newcommand{\propset}{\mathbb{S}_{P}}
\newcommand{\fullset}{\mathbb{S}_{D}}
\newcommand{\nodeid}{\mathrm{ID_{nd}}}
\newcommand{\dsvalue}{\Delta}
\newcommand{\seqnum}{\upsilon}
\newcommand{\termnum}{\mu}
\newcommand{\dstate}{\theta}
\newcommand{\dobj}{\Phi}
\newcommand{\gstate}{\Sigma}
\newcommand{\ldrwitness}{{\witness_{ldr}}}
\newcommand{\opwitness}{{\witness_{op}}}

\newcommand{\tplfunction}{\mathcal{T}}
\newcommand{\tplldrfunction}{\tplfunction_{ldr}}
\newcommand{\tplopfunction}{\tplfunction_{op}}
\newcommand{\handlerfunction}{\tplfunction^{A}}
\newcommand{\genericfunction}{\tplfunction^{R}}
\newcommand{\protocolfunction}{\mathcal{G}}
\newcommand{\ldrhfunction}{\handlerfunction_{ldr}}
\newcommand{\ophfunction}{\handlerfunction_{op}}
\newcommand{\ldrfunction}{\genericfunction_{ldr}}
\newcommand{\opfunction}{\genericfunction_{op}}
\newcommand{\gldrfunction}{\protocolfunction_{ldr}}
\newcommand{\gopfunction}{\protocolfunction_{op}}
\newcommand{\sendfunction}{\delta_{snd}}
\newcommand{\recvfunction}{\delta_{rcv}}

\newcommand{\msg}{\mathrm{msg}}
%\newcommand{\argus}{\mathrm{args}}
\newcommand{\chid}{\mathrm{cid}}

\newcommand{\ldrwcons}{\mathcal{C}_{ldr\witness}}
\newcommand{\opwcons}{\mathcal{C}_{op\witness}}
\newcommand{\conwcons}{\mathcal{C}_{con\witness}}
\newcommand{\sysname}{\textsf{Throne}}

\newcommand\mdoubleplus{\ensuremath{\mathbin{+\mkern-4mu+}}}






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BACK UP From old Section 2
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newcommand\join{\!\bowtie\!}
%\newcommand\Refrel{\sqsubseteq}
%\newcommand\LSem[1]{\textrm{LSem(}#1\textrm{)}}
%\newcommand\ClightX[1]{\textrm{ClightX(}#1\textrm{)}}
%\newcommand\CompCertX[1]{\textrm{CompCertX(}#1\textrm{)}}


% Orders on layers and behaviors: \lsim and \lle correspond to QuiverSim,
% whereas \lpath corresponds to CategorySim.
%\newcommand{\lle}{\preceq}
%\newcommand{\lsim}[1]{\prec_{#1}}
%\newcommand{\lpath}[1]{\le_{#1}}

%\newcommand{\rulename}[1]{\textsc{\smaller{}#1}}
%\newcommand{\kw}[1]{{\mathsf{#1}}} % render as a keyword
%\newcommand{\pset}[1]{{\mathcal{P}({#1})}}
%\newcommand{\Beh}{\mathsf{Beh}} % the set of behaviors
%\newcommand{\Ev}{\mathbb{E}} % the set of events
%\newcommand{\Prog}{\mathbb{P}} % a set of programs
%\newcommand{\Lang}{\mathbb{L}} % a language with log
%\newcommand{\Mach}{\mathbb{M}} % a machine
%\newcommand{\Env}{\mathcal{E}} % an environment context
%\newcommand{\EC}[1]{{\kw{EC}({#1})}} % encironment

%\newcommand\abst{\mathcal{A}}
%\newcommand\primt{\mathcal{P}}

%\tikzset{
%  node_w/.style = {circle, fill=white, draw, inner sep=3pt},
%  node_b/.style = {circle, fill=lightgray, draw, inner sep=3pt},
%  node_d/.style = {circle, double, fill=white, draw, inner sep=3pt},
%  node_db/.style = {circle, double, fill=lightgray, draw, inner sep=3pt},
%  arc_b/.style = {very thick, draw=red, >={stealth[black]}},
%  node_t/.style = {circle, fill=white, draw},
%}

%\newcommand\step[1]{\overset{#1}{\rightarrow}}
%\newcommand\model{\models}
%\newcommand\opsem[3]{l,ge\model #2 \step{#1} #3}
%\newcommand\opsems[3]{l,ge\model #2 \overset{#1}{\rightarrow^*} #3}
%\newcommand\partialf{\rightharpoonup}
%\newcommand\intp{\rhd}
%\newcommand\XADD{\codeinmath{XADD}}
%\newcommand\XCHL{\codeinmath{XCHL}}
%\newcommand\FAA{\codeinmath{FAA}}
%\newcommand\FAI{\codeinmath{FAI}}

%\newcommand\cpush{\codeinmath{push}}
%\newcommand\cpull{\codeinmath{pull}}

%\newcommand\incnow{\codeinmath{inc\_now}}
%\newcommand\getnow{\codeinmath{get\_now}}
%\newcommand\tshared{\codeinmath{tshared}}
%\newcommand\holdlock{\codeinmath{hold}}
%\newcommand\lockstatus{\codeinmath{lock\_status}}
%\newcommand\true{\codeinmath{true}}
%\newcommand\false{\codeinmath{false}}
%\newcommand\ccalwaitlock{\codeinmath{wait\_lock}}
%\newcommand\releaselock{\codeinmath{release\_lock}}



%\newcommand\calwait{\mathbb{B}}
%\newcommand\any{\cdot}
%\newcommand\nonev{\_}
%\newcommand\integer{\mathbb{N}}

%%
%%\newcommand\ccalcode{\kappa}
%\newcommand\acq{\mathsf{acquire}}
%\newcommand\rel{\mathsf{release}}
%\newcommand\deq{\mathsf{deQ}}
%\newcommand\enq{\mathsf{enQ}}
%\newcommand\reach{\mathsf{reachable}}
%\newcommand\now{\mathsf{now}}
%\newcommand\ticket{\mathsf{ticket}}
%\newcommand{\partf}{\rightharpoonup}
%\newcommand\bytelist{\textit{bl}}
%\newcommand\spawn{\mathsf{spawn}}
%\newcommand\yield{\mathsf{yield}}
%\newcommand\cyield{\mathsf{cyield}}
%\newcommand\sleep{\mathsf{sleep}}
%\newcommand\vundef{\mathsf{vundef}}
%\newcommand\ofs{\mathsf{ofs}}
%\newcommand\wakeup{\mathsf{wakeup}}
%\newcommand\regset{rs}
%\newcommand\tid{\mathsf{tid}}
%\newcommand\alist{\rightharpoonup}
%\newcommand\tid{t}
%\newcommand\eempty{\mathsf{empty}}
%\newcommand\option{\mathsf{option}}
%\newcommand\qloc{\mathsf{q\_loc}}
%\newcommand\perm[1]{\mathsf{status}(#1)}
%\newcommand\LAsm{\mathsf{LAsm}}
%\newcommand\TAsm{L_\mathsf{pthread}}
%\newcommand\boot{\mathsf{x86}}
%\newcommand\allid{ID}

%\newcommand\ssem[2]{\llparenthesis {#2}\langle {#1} \rangle \rrparenthesis}



%%% BEGIN CompCert memory model and extensions
%\newcommand{\nextblockOP}[0]{\mathsf{nb}}
%\newcommand{\nextblock}[1]{\nextblockOP({#1})}
%\newcommand{\liftnextblockOP}[0]{\mathsf{liftnb}}
%\newcommand{\liftnextblock}[2]{\liftnextblockOP({#1}, {#2})}
%\newcommand{\extends}[2]{{#1} \subseteq {#2}}
%\newcommand{\inject}[3]{{#2} \stackrel{#1}{\hookrightarrow} {#3}}
%\newcommand{\alloc}[3]{\mathsf{alloc}({#1}, {#2}, {#3})}
%\newcommand{\store}[3]{\mathsf{st}({#1}, {#2}, {#3})}
%\newcommand{\load}[2]{\mathsf{ld}({#1}, {#2})}
%\newcommand{\some}[1]{\left\lfloor {#1} \right\rfloor}
%
%\newcommand{\disjointunionOP}[0]{\circledast}
%\newcommand{\disjointunion}[3]{{#1} \disjointunionOP {#2} \simeq {#3}}
%
%\newcommand\TLayer[3]{#1[#2][#3]}
%\newcommand\Query[3]{#1[{#3}, #2]}
%\newcommand\Compose[3]{\codeinmath{compat}(#1, #2, #3)}

%\newcommand\efrom[1]{(#1\intp)}
%\newcommand\eto[1]{(\intp#1)}
%\newcommand\ssame{\odot}
%\newcommand\sdiff{\triangle}
%\newcommand\mysout[1]{\text{\sout{$#1$}}}
%\newcommand\PLayer[3]{#1^{#3}[#2]}

%\newcommand\Lthread{L_\codeinmath{td}}
%\newcommand\Lbthread{L_\codeinmath{btd}}
%\newcommand\Lhbthread{L_\codeinmath{hbtd}}
%\newcommand\Lhthread{L_\codeinmath{htd}}




%\newcommand{\sstepr}[5]{#1(#2, #3) \ni (#4, #5)}
%\newcommand{\sstep}[4]{#1(#2, #3) \ni (#4)}
%
%\newcommand{\modulef}[1]{#1 \mapsto \kappa_{#1}}

%\newcommand{\remove}[1]{\textcolor{red}{\sout{#1}}}
%\newcommand{\added}[1]{\textcolor{blue}{#1}}
%\newcommand{\return}[0]{\downarrow\!}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



