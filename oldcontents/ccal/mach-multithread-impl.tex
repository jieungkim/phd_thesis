\subsection{Layer Refinement for Thread Linking}\label{subsec:concrete-impl}

In the previous parts of this section,
we show the whole process to 
build a thread-local layer interface
that tackles 
multiple challenges in building multithreaded layer interface.
However, introducing this interface does not mean that all about building thread-local layers and 
linking multiple thread-local layers are straightforward. 

The machines that we have introduced are rely on a global log (a list of events), an abstract data,
and the function that calculates the initial state of each thread in Sec.~\ref{subsec:hasm},  
which are abstract in the interface level. 
In this sense, those things should be concretely instantiated when building layers. 
Therefore, users of our thread local layer interface need a responsibility to 
define instances of those abstract definitions
which are valid with our interface. 
They also need to show that the validity by proving the related lemmas and theorems 
in each step of our processes to build the thread local layer interface.
Obviously, some data structures, such as a memory page permission table
or an IPC (inter process communication) channel, 
cannot be trivially divided into into multiple thread-wise data structures.
In this sense, dividing the whole data structure of concurrent system requires a deep knowledge about how the system works,
and requires an amount of effort. 
Our Coq implementation contains all those instances and proofs, and 
we will automate and optimize this phase in the near future. 